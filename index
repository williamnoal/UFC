<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Instrucional: Moodle em Prática</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonte Inter (Opcional, para ficar bonito) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animações simples */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Estilo para item arrastável */
        .draggable-source { cursor: grab; }
        .draggable-source:active { cursor: grabbing; }
        .draggable-source.selected { border-color: #6366f1; background-color: #eef2ff; transform: scale(1.02); }
    </style>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800 p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-slate-900 mb-2">Design Instrucional no Moodle</h1>
                <p class="text-slate-600 max-w-2xl text-sm md:text-base">
                    Associe cada ferramenta à sua etapa na Trilha Formativa.
                    Escolha pela <span class="font-semibold text-indigo-600">intencionalidade pedagógica</span>.
                    <br><span class="text-xs text-slate-400 mt-1 block">(Arraste o card ou clique para selecionar e depois clique na zona de destino)</span>
                </p>
            </div>
            <div class="flex items-center gap-4 bg-white px-4 py-2 rounded-lg shadow-sm">
                <div class="text-right">
                    <p class="text-xs text-slate-400 uppercase tracking-wide">Pontuação</p>
                    <p class="text-xl font-bold text-indigo-600" id="score-display">0</p>
                </div>
                <button onclick="game.reset()" class="p-2 hover:bg-slate-100 rounded-full transition-colors" title="Reiniciar Jogo">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                </button>
            </div>
        </header>

        <!-- Feedback Toast (Hidden by default) -->
        <div id="toast" class="fixed top-6 right-6 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium flex items-center gap-2 hidden transition-all duration-300 transform translate-x-full">
            <span id="toast-icon"></span>
            <span id="toast-message"></span>
        </div>

        <!-- Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <!-- Sidebar: Items -->
            <div class="lg:col-span-1">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 sticky top-4">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2 text-sm uppercase tracking-wide">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
                        Recursos Disponíveis
                    </h3>
                    
                    <div id="items-container" class="flex flex-col gap-2 min-h-[100px]">
                        <!-- Items will be injected here -->
                    </div>
                    
                    <div id="empty-state-sidebar" class="hidden text-center py-8 text-slate-400 text-sm">
                        Todas as ferramentas alocadas!
                    </div>
                </div>
            </div>

            <!-- Main Area: Zones -->
            <div class="lg:col-span-3">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-full" id="zones-container">
                    <!-- Zones will be injected here -->
                </div>
            </div>

        </div>

        <!-- Completion Modal -->
        <div id="modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4 transition-opacity">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-8 text-center transform scale-95 transition-transform" id="modal-content">
                <div class="w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                </div>
                <h2 class="text-3xl font-bold text-slate-900 mb-2">Trilha Concluída!</h2>
                <p class="text-slate-600 mb-6">
                    Você estruturou uma trilha formativa coerente, movendo o aluno da imersão à síntese com as ferramentas corretas.
                </p>
                
                <div class="bg-slate-50 rounded-lg p-4 mb-8 text-left text-sm text-slate-700 border border-slate-200">
                    <p class="font-semibold mb-2">Resumo da Estratégia:</p>
                    <ul class="space-y-1 list-disc list-inside">
                        <li><span class="font-semibold text-indigo-600">Página/Livro</span> para leitura (Imersão).</li>
                        <li><span class="font-semibold text-indigo-600">Questionário/H5P</span> para teste rápido (Prática).</li>
                        <li><span class="font-semibold text-indigo-600">Fórum</span> para debate crítico (Colaboração).</li>
                        <li><span class="font-semibold text-indigo-600">Tarefa</span> para aplicação final (Síntese).</li>
                    </ul>
                </div>

                <button onclick="game.reset()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors">
                    Jogar Novamente
                </button>
            </div>
        </div>

    </div>

    <!-- Game Logic -->
    <script>
        // Icons (SVG strings)
        const Icons = {
            book: '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 1-4 4v14a3 3 0 0 0 3-3h7z"/></svg>',
            check: '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
            users: '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            file: '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>',
            arrowRight: '<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>',
            checkSm: '<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>',
            xCircle: '<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
        };

        // Data
        const initialItems = [
            { id: 'item-1', title: 'Página e Livro', desc: 'Textos curtos e vídeos embutidos.', intent: 'Consumo com baixa fricção cognitiva.', zoneId: 'zone-1' },
            { id: 'item-2', title: 'Questionário (Quiz)', desc: 'Verificação de memória e entendimento.', intent: 'Feedback automático e robustez avaliativa.', zoneId: 'zone-2' },
            // H5P item removed here
            { id: 'item-4', title: 'Fórum', desc: 'Debate de estudos de caso complexos.', intent: 'Pensamento crítico e troca social.', zoneId: 'zone-3' },
            { id: 'item-5', title: 'Glossário', desc: 'Definições construídas coletivamente.', intent: 'Aluno produtor e colaboração.', zoneId: 'zone-3' },
            { id: 'item-6', title: 'Tarefa', desc: 'Envio de projeto, ensaio ou vídeo final.', intent: 'Criação, síntese e aplicação.', zoneId: 'zone-4' },
            { id: 'item-7', title: 'Laboratório de Avaliação', desc: 'Correção de trabalhos pelos pares.', intent: 'Autonomia e crítica em turmas massivas.', zoneId: 'zone-4' }
        ];

        const zonesConfig = [
            { id: 'zone-1', title: '1. Imersão & Consumo', subtitle: 'O Início da Trilha', icon: Icons.book, color: 'bg-blue-50 border-blue-200 text-blue-800' },
            { id: 'zone-2', title: '2. Prática & Fixação', subtitle: 'O Meio da Trilha', icon: Icons.check, color: 'bg-green-50 border-green-200 text-green-800' },
            { id: 'zone-3', title: '3. Colaboração & Troca', subtitle: 'A Conexão Social', icon: Icons.users, color: 'bg-purple-50 border-purple-200 text-purple-800' },
            { id: 'zone-4', title: '4. Síntese & Entrega', subtitle: 'O Fim da Trilha', icon: Icons.file, color: 'bg-orange-50 border-orange-200 text-orange-800' }
        ];

        class Game {
            constructor() {
                this.items = [];
                this.placedItems = { 'zone-1': [], 'zone-2': [], 'zone-3': [], 'zone-4': [] };
                this.score = 0;
                this.selectedItem = null; // For click-to-select logic
                
                this.dom = {
                    itemsContainer: document.getElementById('items-container'),
                    zonesContainer: document.getElementById('zones-container'),
                    scoreDisplay: document.getElementById('score-display'),
                    emptyState: document.getElementById('empty-state-sidebar'),
                    toast: document.getElementById('toast'),
                    toastMsg: document.getElementById('toast-message'),
                    toastIcon: document.getElementById('toast-icon'),
                    modalOverlay: document.getElementById('modal-overlay'),
                    modalContent: document.getElementById('modal-content')
                };

                this.init();
            }

            init() {
                this.reset();
            }

            reset() {
                this.items = [...initialItems].sort(() => Math.random() - 0.5);
                this.placedItems = { 'zone-1': [], 'zone-2': [], 'zone-3': [], 'zone-4': [] };
                this.score = 0;
                this.selectedItem = null;
                
                this.hideModal();
                this.render();
            }

            // --- Logic ---

            attemptDrop(itemId, targetZoneId) {
                const item = this.items.find(i => i.id === itemId);
                if (!item) return;

                if (item.zoneId === targetZoneId) {
                    // Success
                    this.items = this.items.filter(i => i.id !== itemId);
                    this.placedItems[targetZoneId].push(item);
                    this.score += 100;
                    this.showToast(`Correto! ${item.title} encaixa aqui.`, 'success');
                    
                    if (this.items.length === 0) {
                        setTimeout(() => this.showModal(), 1000);
                    }
                } else {
                    // Fail
                    this.score = Math.max(0, this.score - 20);
                    this.showToast('Intencionalidade incorreta. Tente novamente.', 'error');
                }
                
                this.selectedItem = null; // Reset selection
                this.render();
            }

            selectItem(itemId) {
                if (this.selectedItem === itemId) {
                    this.selectedItem = null; // Deselect
                } else {
                    this.selectedItem = itemId;
                }
                this.render(); // Re-render to show selection border
            }

            // --- Rendering ---

            render() {
                this.dom.scoreDisplay.textContent = this.score;
                this.renderItems();
                this.renderZones();
            }

            renderItems() {
                this.dom.itemsContainer.innerHTML = '';
                
                if (this.items.length === 0) {
                    this.dom.emptyState.classList.remove('hidden');
                } else {
                    this.dom.emptyState.classList.add('hidden');
                    this.items.forEach(item => {
                        const el = document.createElement('div');
                        const isSelected = this.selectedItem === item.id;
                        
                        el.className = `draggable-source bg-white p-3 mb-2 rounded-lg border shadow-sm transition-all hover:shadow-md group slide-in ${isSelected ? 'border-indigo-500 ring-2 ring-indigo-200 bg-indigo-50' : 'border-slate-200'}`;
                        el.draggable = true;
                        el.innerHTML = `
                            <div class="flex items-center justify-between mb-1 pointer-events-none">
                                <h4 class="font-semibold text-slate-800 text-sm">${item.title}</h4>
                                <div class="bg-slate-100 p-1 rounded group-hover:bg-indigo-50 transition-colors">
                                    <span class="text-slate-400 group-hover:text-indigo-500">${Icons.arrowRight}</span>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 italic pointer-events-none">${item.desc}</p>
                        `;

                        // Drag Events
                        el.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', item.id);
                            e.dataTransfer.effectAllowed = 'move';
                            this.selectedItem = item.id; // Auto select on drag
                        });

                        // Click Event (for mobile/accessibility)
                        el.addEventListener('click', () => this.selectItem(item.id));

                        this.dom.itemsContainer.appendChild(el);
                    });
                }
            }

            renderZones() {
                this.dom.zonesContainer.innerHTML = '';
                
                zonesConfig.forEach(zone => {
                    const placedInThisZone = this.placedItems[zone.id];
                    
                    const zoneEl = document.createElement('div');
                    // Add styles for when item is selected (visual cue)
                    const activeClass = this.selectedItem ? 'cursor-pointer hover:border-indigo-400' : '';
                    
                    zoneEl.className = `flex flex-col h-full rounded-xl border-2 transition-all duration-300 bg-slate-50 border-slate-200 ${activeClass}`;
                    
                    zoneEl.innerHTML = `
                        <div class="p-4 rounded-t-xl border-b ${zone.color} bg-opacity-50">
                            <div class="flex items-center gap-2 mb-1">
                                ${zone.icon}
                                <h3 class="font-bold text-sm uppercase tracking-wider">${zone.title}</h3>
                            </div>
                            <p class="text-xs opacity-80">${zone.subtitle}</p>
                        </div>
                        <div class="flex-1 p-3 min-h-[140px] space-y-2 zone-body" data-zone-id="${zone.id}">
                            ${placedInThisZone.length === 0 
                                ? `<div class="h-full flex items-center justify-center text-slate-300 text-xs text-center px-4 pointer-events-none">Arraste aqui</div>` 
                                : ''}
                        </div>
                    `;

                    // Container for items inside the zone
                    const bodyEl = zoneEl.querySelector('.zone-body');
                    
                    // Render placed items
                    placedInThisZone.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'bg-white p-2 rounded border border-green-200 shadow-sm flex items-start gap-2 fade-in';
                        itemEl.innerHTML = `
                            <span class="mt-0.5 flex-shrink-0">${Icons.checkSm}</span>
                            <div>
                                <p class="text-xs font-bold text-slate-700">${item.title}</p>
                                <p class="text-[10px] text-slate-500 leading-tight">${item.intent}</p>
                            </div>
                        `;
                        bodyEl.appendChild(itemEl);
                    });

                    // Drop Events
                    zoneEl.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        zoneEl.classList.add('border-indigo-300', 'bg-indigo-50');
                    });
                    
                    zoneEl.addEventListener('dragleave', () => {
                        zoneEl.classList.remove('border-indigo-300', 'bg-indigo-50');
                    });

                    zoneEl.addEventListener('drop', (e) => {
                        e.preventDefault();
                        zoneEl.classList.remove('border-indigo-300', 'bg-indigo-50');
                        const itemId = e.dataTransfer.getData('text/plain');
                        this.attemptDrop(itemId, zone.id);
                    });

                    // Click to Drop (if item selected)
                    zoneEl.addEventListener('click', () => {
                        if (this.selectedItem) {
                            this.attemptDrop(this.selectedItem, zone.id);
                        }
                    });

                    this.dom.zonesContainer.appendChild(zoneEl);
                });
            }

            // --- UI Helpers ---

            showToast(msg, type) {
                const { toast, toastMsg, toastIcon } = this.dom;
                
                toast.classList.remove('hidden', 'translate-x-full', 'bg-green-600', 'bg-red-500');
                
                if (type === 'success') {
                    toast.classList.add('bg-green-600');
                    toastIcon.innerHTML = Icons.check;
                } else {
                    toast.classList.add('bg-red-500');
                    toastIcon.innerHTML = Icons.xCircle;
                }
                
                toastMsg.textContent = msg;
                toast.classList.remove('hidden');
                
                // Trigger animation
                setTimeout(() => toast.classList.remove('translate-x-full'), 10);

                // Auto hide
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => toast.classList.add('hidden'), 300);
                }, 2500);
            }

            showModal() {
                this.dom.modalOverlay.classList.remove('hidden');
                this.dom.modalOverlay.classList.add('flex');
            }

            hideModal() {
                this.dom.modalOverlay.classList.add('hidden');
                this.dom.modalOverlay.classList.remove('flex');
            }
        }

        // Initialize Game
        const game = new Game();

    </script>
</body>
</html>
